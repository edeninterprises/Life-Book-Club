<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple Poster Generator</title>
<style>
:root{
  --bg:#0f172a;
  --panel:#111827;
  --muted:#64748b;
  --accent:#22c55e;
  --text:#e5e7eb;
  --btn:#1f2937;
  --btn2:#334155;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
header{padding:20px 16px;border-bottom:1px solid #1f2937;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
header h1{font-size:18px;margin:0;font-weight:700;letter-spacing:0.3px}
header .sub{font-size:12px;color:var(--muted)}
.wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
@media (max-width: 960px){.wrap{grid-template-columns:1fr}}
.panel{background:var(--panel);border:1px solid #1f2937;border-radius:16px;overflow:hidden}
.panel h2{margin:0;padding:14px 14px;border-bottom:1px solid #1f2937;font-size:14px;color:#cbd5e1}
.panel .content{padding:14px;display:flex;flex-direction:column;gap:12px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
label{font-size:12px;color:#cbd5e1}
input[type="file"]{appearance:none;background:var(--btn);border:1px solid #1f2937;color:var(--text);padding:8px;border-radius:10px;font-size:13px;width:100%}
.btn{appearance:none;border:1px solid #1f2937;background:var(--btn2);color:#e2e8f0;padding:10px 12px;border-radius:12px;font-weight:600;font-size:13px;cursor:pointer}
.btn:hover{filter:brightness(1.1)}
.btn.primary{background:var(--accent);border-color:#16a34a;color:#052e16}
canvas{width:100%;height:auto;display:block;background:#000;border-radius:16px;border:1px solid #1f2937}
.canvasWrap{position:relative}
.small{font-size:11px;color:#94a3b8}
</style>
</head>
<body>
<header>
<h1>Simple Poster Generator</h1>
<span class="sub">Upload a user photo and download poster.</span>
</header>
<div class="wrap">
<aside class="panel">
  <h2>Controls</h2>
  <div class="content">
    <div>
      <label>User Photo</label>
      <input id="photoInput" type="file" accept="image/*" />
    </div>
    <div class="row">
      <button id="downloadBtn" class="btn primary">Download PNG</button>
      <button id="clearBtn" class="btn">Clear</button>
    </div>
    <div class="small">All processing is in your browser. No files are uploaded.</div>
  </div>
</aside>
<main class="panel">
  <h2>Preview</h2>
  <div class="content">
    <div class="canvasWrap">
      <canvas id="c" width="4320" height="5400"></canvas>
    </div>
    <div class="small">Preview</div>
  </div>
</main>
</div>

<script>
// ====== Place your default template here ======
const DEFAULT_TEMPLATE_URL = 'template.png'; // <-- replace with your template path or URL

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const photoInput = document.getElementById('photoInput');
const downloadBtn = document.getElementById('downloadBtn');
const clearBtn = document.getElementById('clearBtn');

let templateImg = null;
let userImg = null;
let userReady = false;

// Area where user photo will be drawn
const photoArea = { x:0, y:0, w:1700.5, h:2037.5 };

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Draw template
  if(templateImg?.complete){
    ctx.drawImage(templateImg,0,0,canvas.width,canvas.height);
  } else {
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  // Draw user photo (fill area with cropping)
  if(userImg?.complete){
    const imgRatio = userImg.width / userImg.height;
    const areaRatio = photoArea.w / photoArea.h;

    let sx, sy, sw, sh;

    if(imgRatio > areaRatio){
      // photo wider -> crop sides
      sh = userImg.height;
      sw = sh * areaRatio;
      sx = (userImg.width - sw)/2;
      sy = 0;
    } else {
      // photo taller -> crop top/bottom
      sw = userImg.width;
      sh = sw / areaRatio;
      sx = 0;
      sy = (userImg.height - sh)/2;
    }

    ctx.drawImage(userImg, sx, sy, sw, sh, photoArea.x, photoArea.y, photoArea.w, photoArea.h);
  }
}

// Load template
if(DEFAULT_TEMPLATE_URL){
  templateImg = new Image();
  templateImg.onload = draw;
  templateImg.src = DEFAULT_TEMPLATE_URL;
}

// Upload user photo
photoInput.addEventListener('change', e=>{
  const f = e.target.files?.[0];
  if(!f) return;
  userImg = new Image();
  userReady = false;
  userImg.onload = ()=>{
    userReady = true;
    draw();
  };
  userImg.src = URL.createObjectURL(f);
});

// Download
downloadBtn.addEventListener('click', ()=>{
  if(!userImg || !userReady){
    alert("Photo is not ready yet!");
    return;
  }
  canvas.toBlob(blob=>{
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'poster.png';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }, 'image/png');
});

// Clear photo
clearBtn.addEventListener('click', ()=>{
  userImg = null;
  userReady = false;
  draw();
});

draw();
</script>
</body>
</html>
